<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="qrCode.title">Gerador de QR Code - MyTools</title>
    <meta name="description" content="Gere QR codes gratuitos para textos, URLs, emails e mais. R√°pido, f√°cil e sem cadastro necess√°rio.">
    <meta name="keywords" content="gerador qr code, criar qr code, qr code gratuito, c√≥digo qr">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../assets/img/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="../assets/img/favicon.ico">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1B0YZFHHQC"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-1B0YZFHHQC');
    </script>
    
    <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="../index.html" class="logo">
                <img src="../assets/img/logo.png" alt="Blue toolbox with a wrench symbol on the front, positioned to the left of the words MyTools written in large friendly letters. The logo conveys a helpful and approachable atmosphere for an online tools website." class="logo-image">
            </a>
            <button class="nav-toggle" aria-label="Abrir menu">‚ò∞</button>
            <nav class="nav">
                <ul class="nav-list">
                    <li><a href="../" class="nav-link" data-i18n="nav.home">In√≠cio</a></li>
                    <li><a href="../about.html" class="nav-link" data-i18n="nav.about">Sobre</a></li>
                    <li><a href="../contact.html" class="nav-link" data-i18n="nav.contact">Contato</a></li>
                </ul>
                <div class="search-container">
                    <!-- Language selector will be inserted here -->
                </div>
            </nav>
        </div>
    </header>

    <main class="main">
        <div class="hero">
            <h1 data-i18n="qrCode.title">üì± Gerador de QR Code</h1>
            <p data-i18n="qrCode.subtitle">Crie QR codes para textos, URLs, emails e muito mais</p>
        </div>

        <div class="form-container">
            <div class="form-group">
                <label for="qrType" class="form-label" data-i18n="qrCode.type">Tipo de QR Code:</label>
                <select id="qrType" class="form-select">
                    <option value="text" data-i18n="qrCode.typeText">Texto</option>
                    <option value="url" data-i18n="qrCode.typeUrl">URL/Link</option>
                    <option value="email" data-i18n="qrCode.typeEmail">Email</option>
                    <option value="phone" data-i18n="qrCode.typePhone">Telefone</option>
                    <option value="sms" data-i18n="qrCode.typeSms">SMS</option>
                    <option value="wifi" data-i18n="qrCode.typeWifi">WiFi</option>
                </select>
            </div>

            <div id="textInput" class="input-section">
                <div class="form-group">
                    <label for="textContent" class="form-label" data-i18n="qrCode.content">Texto:</label>
                    <textarea id="textContent" class="form-textarea" data-i18n-placeholder="qrCode.placeholder.text" placeholder="Digite o texto para o QR Code" rows="4"></textarea>
                </div>
            </div>

            <div id="urlInput" class="input-section" style="display: none;">
                <div class="form-group">
                    <label for="urlContent" class="form-label">URL:</label>
                    <input type="url" id="urlContent" class="form-input" data-i18n-placeholder="qrCode.placeholder.url" placeholder="https://exemplo.com">
                </div>
            </div>

            <div id="emailInput" class="input-section" style="display: none;">
                <div class="form-group">
                    <label for="emailContent" class="form-label" data-i18n="qrCode.typeEmail">Email:</label>
                    <input type="email" id="emailContent" class="form-input" data-i18n-placeholder="qrCode.placeholder.email" placeholder="exemplo@email.com">
                </div>
                <div class="form-group">
                    <label for="emailSubject" class="form-label">Assunto (opcional):</label>
                    <input type="text" id="emailSubject" class="form-input" placeholder="Assunto do email">
                </div>
                <div class="form-group">
                    <label for="emailBody" class="form-label">Mensagem (opcional):</label>
                    <textarea id="emailBody" class="form-textarea" placeholder="Corpo do email" rows="3"></textarea>
                </div>
            </div>

            <div id="phoneInput" class="input-section" style="display: none;">
                <div class="form-group">
                    <label for="phoneContent" class="form-label" data-i18n="qrCode.typePhone">Telefone:</label>
                    <input type="tel" id="phoneContent" class="form-input" data-i18n-placeholder="qrCode.placeholder.phone" placeholder="+55 11 99999-9999">
                </div>
            </div>

            <div id="smsInput" class="input-section" style="display: none;">
                <div class="form-group">
                    <label for="smsPhone" class="form-label" data-i18n="qrCode.sms.number">Telefone:</label>
                    <input type="tel" id="smsPhone" class="form-input" data-i18n-placeholder="qrCode.placeholder.phone" placeholder="+55 11 99999-9999">
                </div>
                <div class="form-group">
                    <label for="smsMessage" class="form-label" data-i18n="qrCode.sms.message">Mensagem:</label>
                    <textarea id="smsMessage" class="form-textarea" data-i18n-placeholder="qrCode.placeholder.sms" placeholder="Mensagem do SMS" rows="3"></textarea>
                </div>
            </div>

            <div id="wifiInput" class="input-section" style="display: none;">
                <div class="form-group">
                    <label for="wifiSSID" class="form-label" data-i18n="qrCode.wifi.network">Nome da Rede (SSID):</label>
                    <input type="text" id="wifiSSID" class="form-input" data-i18n-placeholder="qrCode.placeholder.wifi" placeholder="Nome da rede WiFi">
                </div>
                <div class="form-group">
                    <label for="wifiPassword" class="form-label" data-i18n="qrCode.wifi.password">Senha:</label>
                    <input type="text" id="wifiPassword" class="form-input" placeholder="Senha da rede">
                </div>
                <div class="form-group">
                    <label for="wifiSecurity" class="form-label" data-i18n="qrCode.wifi.security">Tipo de Seguran√ßa:</label>
                    <select id="wifiSecurity" class="form-select">
                        <option value="WPA" data-i18n="qrCode.wifi.securityWpa">WPA/WPA2</option>
                        <option value="WEP" data-i18n="qrCode.wifi.securityWep">WEP</option>
                        <option value="nopass" data-i18n="qrCode.wifi.securityNone">Sem senha</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="wifiHidden"> <span data-i18n="qrCode.wifi.hidden">Rede oculta</span>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label for="qrSize" class="form-label" data-i18n="qrCode.size">Tamanho:</label>
                <select id="qrSize" class="form-select">
                    <option value="200" data-i18n="qrCode.sizeSmall">200x200 (Pequeno)</option>
                    <option value="300" selected data-i18n="qrCode.sizeMedium">300x300 (M√©dio)</option>
                    <option value="400" data-i18n="qrCode.sizeLarge">400x400 (Grande)</option>
                    <option value="500" data-i18n="qrCode.sizeXLarge">500x500 (Extra Grande)</option>
                </select>
            </div>

            <button onclick="generateQRCode()" class="btn btn-primary btn-full" data-i18n="qrCode.generate">Gerar QR Code</button>

            <div id="qrResult" class="result-area" style="display: none;">
                <div style="text-align: center; margin-bottom: 1rem;">
                    <canvas id="qrCanvas"></canvas>
                </div>
                <div class="result-actions">
                    <button onclick="downloadQR()" class="btn btn-primary" data-i18n="qrCode.download">Download PNG</button>
                    <button onclick="copyQRImage()" class="btn btn-secondary" data-i18n="qrCode.copy">Copiar Imagem</button>
                    <button onclick="clearQR()" class="btn btn-secondary" data-i18n="qrCode.clear">Limpar</button>
                </div>
            </div>
        </div>

        <div class="form-container">
            <h3 data-i18n="qrCode.howToUse">Como usar o Gerador de QR Code</h3>
            <ol>
                <li data-i18n="qrCode.howTo1">Escolha o tipo de QR Code que deseja criar</li>
                <li data-i18n="qrCode.howTo2">Preencha as informa√ß√µes necess√°rias</li>
                <li data-i18n="qrCode.howTo3">Selecione o tamanho desejado</li>
                <li data-i18n="qrCode.howTo4">Clique em "Gerar QR Code"</li>
                <li data-i18n="qrCode.howTo5">Fa√ßa o download ou copie a imagem gerada</li>
            </ol>

            <h3 data-i18n="qrCode.supportedTypes">Tipos de QR Code Suportados</h3>
            <ul>
                <li><strong data-i18n="qrCode.typeText">Texto:</strong> <span data-i18n="qrCode.textDescription">Qualquer texto simples</span></li>
                <li><strong data-i18n="qrCode.typeUrl">URL:</strong> <span data-i18n="qrCode.urlDescription">Links para sites ou p√°ginas web</span></li>
                <li><strong data-i18n="qrCode.typeEmail">Email:</strong> <span data-i18n="qrCode.emailDescription">Abre o cliente de email com destinat√°rio pr√©-preenchido</span></li>
                <li><strong data-i18n="qrCode.typePhone">Telefone:</strong> <span data-i18n="qrCode.phoneDescription">Inicia uma chamada telef√¥nica</span></li>
                <li><strong data-i18n="qrCode.typeSms">SMS:</strong> <span data-i18n="qrCode.smsDescription">Abre o app de mensagens com n√∫mero e texto</span></li>
                <li><strong data-i18n="qrCode.typeWifi">WiFi:</strong> <span data-i18n="qrCode.wifiDescription">Conecta automaticamente √† rede WiFi</span></li>
            </ul>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-grid">
                <div class="footer-section">
                    <h4 data-i18n="footer.tools">Ferramentas</h4>
                    <ul class="footer-links">
                        <li><a href="converter-temperatura.html" data-i18n="footer.temperatureConverter">Conversor de Temperatura</a></li>
                        <li><a href="converter-medidas.html" data-i18n="footer.unitConverter">Conversor de Medidas</a></li>
                        <li><a href="texto-maiusculas-minusculas.html" data-i18n="footer.textCase">Mai√∫sculas/Min√∫sculas</a></li>
                        <li><a href="contador-texto.html" data-i18n="footer.textCounter">Contador de Texto</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4 data-i18n="footer.generators">Geradores</h4>
                    <ul class="footer-links">
                        <li><a href="gerar-qr-code.html" data-i18n="footer.qrGenerator">Gerador QR Code</a></li>
                        <li><a href="gerador-md5.html" data-i18n="footer.md5Generator">Gerador MD5</a></li>
                        <li><a href="codificador-base64.html" data-i18n="footer.base64">Base64</a></li>
                        <li><a href="timestamp-converter.html" data-i18n="footer.timestamp">Timestamp</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4 data-i18n="footer.about">Sobre</h4>
                    <ul class="footer-links">
                        <li><a href="../about.html" data-i18n="footer.aboutUs">Sobre N√≥s</a></li>
                        <li><a href="../contact.html" data-i18n="footer.contact">Contato</a></li>
                        <li><a href="../privacy.html" data-i18n="footer.privacy">Privacidade</a></li>
                        <li><a href="../terms.html" data-i18n="footer.terms">Termos de Uso</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4 data-i18n="footer.mytools">MyTools</h4>
                    <p data-i18n="footer.description">Ferramentas √∫teis e gratuitas para facilitar seu dia a dia.</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 MyTools. <span data-i18n="footer.rights">Todos os direitos reservados.</span></p>
            </div>
        </div>
    </footer>

    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/qrcode.js"></script>
    <script>
        console.log('QRCode library loaded:', typeof QRCode);
    </script>
    <script>
        let currentQRData = '';

        function showInputSection() {
            const qrType = document.getElementById('qrType').value;
            const sections = document.querySelectorAll('.input-section');
            
            sections.forEach(section => section.style.display = 'none');
            document.getElementById(qrType + 'Input').style.display = 'block';
        }

        function getQRContent() {
            const qrType = document.getElementById('qrType').value;
            
            switch(qrType) {
                case 'text':
                    return document.getElementById('textContent').value;
                
                case 'url':
                    let url = document.getElementById('urlContent').value;
                    if (url && !url.startsWith('http://') && !url.startsWith('https://')) {
                        url = 'https://' + url;
                    }
                    return url;
                
                case 'email':
                    const email = document.getElementById('emailContent').value;
                    const subject = document.getElementById('emailSubject').value;
                    const body = document.getElementById('emailBody').value;
                    let mailto = `mailto:${email}`;
                    const params = [];
                    if (subject) params.push(`subject=${encodeURIComponent(subject)}`);
                    if (body) params.push(`body=${encodeURIComponent(body)}`);
                    if (params.length > 0) mailto += '?' + params.join('&');
                    return mailto;
                
                case 'phone':
                    return `tel:${document.getElementById('phoneContent').value}`;
                
                case 'sms':
                    const smsPhone = document.getElementById('smsPhone').value;
                    const smsMessage = document.getElementById('smsMessage').value;
                    return `sms:${smsPhone}${smsMessage ? '?body=' + encodeURIComponent(smsMessage) : ''}`;
                
                case 'wifi':
                    const ssid = document.getElementById('wifiSSID').value;
                    const password = document.getElementById('wifiPassword').value;
                    const security = document.getElementById('wifiSecurity').value;
                    const hidden = document.getElementById('wifiHidden').checked;
                    return `WIFI:T:${security};S:${ssid};P:${password};H:${hidden ? 'true' : 'false'};;`;
                
                default:
                    return '';
            }
        }

        function generateQRCode(isAutoGenerate = false) {
            try {
                const content = getQRContent();
                const size = parseInt(document.getElementById('qrSize').value);
                const canvas = document.getElementById('qrCanvas');
                
                if (!canvas) {
                    console.error('Canvas element not found');
                    if (!isAutoGenerate) {
                        alert('Erro: elemento canvas n√£o encontrado.');
                    }
                    return;
                }
                
                if (!content.trim()) {
                    if (!isAutoGenerate) {
                        alert('Por favor, preencha o conte√∫do para o QR Code.');
                    }
                    return;
                }

                // Library check
                if (typeof QRCode === 'undefined') {
                    if (!isAutoGenerate) {
                        alert('Erro interno: Biblioteca QR Code n√£o dispon√≠vel.');
                    }
                    return;
                }

                currentQRData = content;

                // Clear canvas before generating new QR code
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // Create a temporary div for the QRCode library
                const tempDiv = document.createElement('div');
                tempDiv.style.position = 'absolute';
                tempDiv.style.left = '-9999px';
                tempDiv.style.width = size + 'px';
                tempDiv.style.height = size + 'px';
                document.body.appendChild(tempDiv);

                try {
                    // Generate QR Code using the professional library
                    const qr = new QRCode(tempDiv, {
                        text: content,
                        width: size,
                        height: size,
                        colorDark: '#000000',
                        colorLight: '#ffffff',
                        correctLevel: QRCode.CorrectLevel.H
                    });

                    // Wait for QR code generation
                    setTimeout(() => {
                        try {
                            // Find the generated canvas or image
                            const qrCanvas = tempDiv.querySelector('canvas');
                            const qrImg = tempDiv.querySelector('img');
                            
                            if (qrCanvas) {
                                // Copy from generated canvas to our canvas
                                canvas.width = size;
                                canvas.height = size;
                                ctx.drawImage(qrCanvas, 0, 0);
                                
                                const qrResult = document.getElementById('qrResult');
                                if (qrResult) {
                                    qrResult.style.display = 'block';
                                }
                                console.log('QR Code generated successfully');
                            } else if (qrImg && qrImg.src) {
                                // If it's an image, load it into canvas
                                const img = new Image();
                                img.onload = function() {
                                    canvas.width = size;
                                    canvas.height = size;
                                    ctx.drawImage(img, 0, 0);
                                    
                                    const qrResult = document.getElementById('qrResult');
                                    if (qrResult) {
                                        qrResult.style.display = 'block';
                                    }
                                    console.log('QR Code generated successfully from image');
                                };
                                img.src = qrImg.src;
                            } else {
                                throw new Error('Could not find generated QR Code');
                            }
                        } catch (error) {
                            console.error('Error processing QR Code:', error);
                            if (!isAutoGenerate) {
                                alert('Erro ao processar QR Code. Tente novamente.');
                            }
                        } finally {
                            // Clean up temporary div
                            document.body.removeChild(tempDiv);
                        }
                    }, 100);

                } catch (error) {
                    console.error('QR Code library error:', error);
                    document.body.removeChild(tempDiv);
                    if (!isAutoGenerate) {
                        alert('Erro ao gerar QR Code. Verifique o conte√∫do e tente novamente.');
                    }
                }
            } catch (error) {
                console.error('QR Code generation exception:', error);
                if (!isAutoGenerate) {
                    alert('Erro inesperado ao gerar QR Code. Recarregue a p√°gina e tente novamente.');
                }
            }
        }

        function downloadQR() {
            const canvas = document.getElementById('qrCanvas');
            
            if (!canvas || !canvas.width || !canvas.height) {
                alert('Gere um QR Code primeiro!');
                return;
            }
            
            try {
                const link = document.createElement('a');
                link.download = 'qrcode.png';
                link.href = canvas.toDataURL('image/png');
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (error) {
                console.error('Erro ao fazer download:', error);
                alert('Erro ao fazer download da imagem. Tente novamente.');
            }
        }

        function copyQRImage() {
            const canvas = document.getElementById('qrCanvas');
            
            if (!canvas || !canvas.width || !canvas.height) {
                if (typeof showNotification === 'function') {
                    showNotification('Gere um QR Code primeiro!', 'error');
                } else {
                    alert('Gere um QR Code primeiro!');
                }
                return;
            }
            
            try {
                canvas.toBlob(function(blob) {
                    if (!blob) {
                        throw new Error('Falha ao criar blob da imagem');
                    }
                    
                    if (navigator.clipboard && navigator.clipboard.write) {
                        const item = new ClipboardItem({ 'image/png': blob });
                        navigator.clipboard.write([item]).then(function() {
                            if (typeof showNotification === 'function') {
                                showNotification('QR Code copiado para a √°rea de transfer√™ncia!', 'success');
                            } else {
                                alert('QR Code copiado para a √°rea de transfer√™ncia!');
                            }
                        }).catch(function(err) {
                            console.error('Erro ao copiar imagem:', err);
                            if (typeof showNotification === 'function') {
                                showNotification('Erro ao copiar imagem. Use o bot√£o de download.', 'error');
                            } else {
                                alert('Erro ao copiar imagem. Use o bot√£o de download.');
                            }
                        });
                    } else {
                        if (typeof showNotification === 'function') {
                            showNotification('Seu navegador n√£o suporta copiar imagens. Use o bot√£o de download.', 'error');
                        } else {
                            alert('Seu navegador n√£o suporta copiar imagens. Use o bot√£o de download.');
                        }
                    }
                }, 'image/png');
            } catch (error) {
                console.error('Erro ao processar imagem:', error);
                if (typeof showNotification === 'function') {
                    showNotification('Erro ao processar imagem. Tente novamente.', 'error');
                } else {
                    alert('Erro ao processar imagem. Tente novamente.');
                }
            }
        }

        function clearQR() {
            try {
                // Clear all inputs
                const inputs = document.querySelectorAll('input, textarea, select');
                inputs.forEach(input => {
                    if (input.type === 'checkbox') {
                        input.checked = false;
                    } else if (input.id !== 'qrType' && input.id !== 'qrSize') {
                        input.value = '';
                    }
                });
                
                // Reset selects to default values
                document.getElementById('qrType').value = 'text';
                document.getElementById('qrSize').value = '300';
                
                // Hide result area and clear canvas
                const qrResult = document.getElementById('qrResult');
                if (qrResult) {
                    qrResult.style.display = 'none';
                }
                
                const canvas = document.getElementById('qrCanvas');
                if (canvas) {
                    const ctx = canvas.getContext('2d');
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    canvas.width = 0;
                    canvas.height = 0;
                }
                
                // Reset current data
                currentQRData = '';
                
                // Show correct input section
                showInputSection();
                
                // Clear any timeouts
                if (window.qrTimeout) {
                    clearTimeout(window.qrTimeout);
                }
                
            } catch (error) {
                console.error('Erro ao limpar formul√°rio:', error);
                alert('Erro ao limpar formul√°rio. Recarregue a p√°gina se necess√°rio.');
            }
        }

        // Event listeners
        document.getElementById('qrType').addEventListener('change', showInputSection);

        // Auto-generate QR code when content changes
        document.addEventListener('input', function(e) {
            if (e.target.closest('.input-section') || e.target.id === 'qrSize') {
                const content = getQRContent();
                if (content.trim() && isQRCodeReady()) {
                    // Wait a bit to avoid too many calls
                    clearTimeout(window.qrTimeout);
                    window.qrTimeout = setTimeout(() => generateQRCode(true), 300);
                }
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            showInputSection();
            console.log('QRCode library ready:', isQRCodeReady());
        });
    </script>
    <script src="../assets/js/i18n.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const i18n = new I18n();
            i18n.init();
        });
    </script>
</body>
</html>
